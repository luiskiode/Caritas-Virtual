<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Validar dirección</title>
  <link rel="stylesheet" href="estilos-familias.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div class="container">
    <h2>Validar Dirección</h2>
    <div id="mapa" style="height:400px;border-radius:8px"></div>
  </div>

<script>
document.addEventListener('DOMContentLoaded', async ()=>{
  const urlParams = new URLSearchParams(location.search);
  const dir = urlParams.get('dir') || '';
  const map = L.map('mapa').setView([-12.0464,-77.0428],13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  if(dir){
    try{
      const resp = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(dir)}`);
      const data = await resp.json();
      if(data && data[0]){
        const coords = [parseFloat(data[0].lat), parseFloat(data[0].lon)];
        L.marker(coords).addTo(map).bindPopup(dir).openPopup();
        map.setView(coords,16);
      }
    }catch(err){ console.error(err); }
  }
});
</script>
</body>
</html>