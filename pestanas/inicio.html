<section class="inicio-card" id="tab-inicio">
  <!-- 📝 Mensaje semanal -->
  <article class="card" id="mensaje-semanal">
    <h3 class="with-emoji" data-emoji="📝">Mensaje Semanal</h3>
    <p>
      ✨ <strong>Querido Voluntario</strong>, la caridad es paciente, la caridad es
      benigna; no es envidiosa, no obra con soberbia, no se jacta, no es ambiciosa,
      no busca lo suyo, no se irrita, no toma en cuenta el mal, no se alegra por la
      injusticia, se complace con la verdad; todo lo aguanta, todo lo cree, todo lo
      espera, todo lo soporta. 🙏 Rezo por ello; y ustedes también, por favor, recen
      por mí. ❤️‍🔥
    </p>
  </article>

  <!-- 📌 Pendientes (solo lectura) -->
  <article class="card">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:.5rem;">
      <h3>📌 Mis pendientes</h3>
      <small class="pill">vista solo lectura</small>
    </header>
    <div id="pendientes-home-empty" class="muted" hidden>
      Sin pendientes aún. ✨
    </div>
    <table aria-label="Tabla de pendientes">
      <thead>
        <tr><th scope="col">Tarea</th><th scope="col" style="width:120px">Estado</th></tr>
      </thead>
      <tbody id="pendientesHomeBody"></tbody>
    </table>
  </article>

  <!-- 🌟 Misión / 🚀 Visión -->
  <article class="card mision-vision">
    <div class="mision">
      <h3>🌟 Nuestra Misión</h3>
      <ul>
        <li>❤️ Servir con respeto y empatía a las familias más necesitadas.</li>
        <li>🙏 Guiarnos por la fe, el compromiso y la compasión.</li>
        <li>🤝 Promover dignidad, justicia y solidaridad.</li>
        <li>🌱 Trabajar unidos para crear oportunidades y esperanza.</li>
        <li>🔥 Transformar vidas a través de la acción social.</li>
      </ul>
    </div>
    <div class="vision">
      <h3>🚀 Nuestra Visión</h3>
      <ul>
        <li>🏛 Ser referente de servicio y apoyo.</li>
        <li>💡 Construir una comunidad fraterna.</li>
        <li>✝ Inspirarnos en el Evangelio.</li>
        <li>🌍 Promover justicia social y desarrollo integral.</li>
        <li>🤗 Acompañar con acogida y transformación.</li>
      </ul>
    </div>
    <p class="agradecimiento">🙏 ¡Gracias por ser parte de esta misión! ❤️</p>
  </article>

  <!-- 📷 Galería -->
  <article class="card">
    <h3>📷 Nuestra comunidad</h3>
    <div class="galeria-grid">
      <img src="img/imagen de grupo 1.jpeg" alt="Grupo 1 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 2.jpeg" alt="Grupo 2 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 3.jpeg" alt="Grupo 3 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 4.jpeg" alt="Grupo 4 de voluntarios" class="miniatura" loading="lazy"/>
      <img src="img/imagen de grupo 5.jpeg" alt="Grupo 5 de voluntarios" class="miniatura" loading="lazy"/>
    </div>
  </article>

  <!-- 🖼️ Modal galería -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
    <button class="cerrar" id="modalClose" aria-label="Cerrar">✖️</button>
    <img class="modal-contenido" id="img-ampliada" alt="Vista ampliada" />
    <div id="caption" class="muted" style="margin-top:.4rem"></div>
  </div>
</section>

<script>
/* 🔧 Comportamiento de la pestaña Inicio (Cáritas) */
(() => {
  'use strict';

  // === Galería con modal ===
  const modal      = document.getElementById('modal');
  const modalImg   = document.getElementById('img-ampliada');
  const modalClose = document.getElementById('modalClose');
  const caption    = document.getElementById('caption');

  if (modal && modalImg && modalClose) {
    document.querySelectorAll('.galeria-grid img').forEach(img => {
      img.addEventListener('click', () => {
        modal.style.display = 'flex';
        modal.setAttribute('aria-hidden','false');
        modalImg.src = img.src;
        caption.textContent = img.alt || '';
        modalImg.focus();
      });
    });
    modalClose.addEventListener('click', () => {
      modal.style.display='none';
      modal.setAttribute('aria-hidden','true');
    });
    modal.addEventListener('click', e => {
      if (e.target === modal) modalClose.click();
    });
    window.addEventListener('keydown', e => {
      if (e.key === 'Escape') modalClose.click();
    });
  }

  // === Pendientes (solo lectura) ===
  async function renderPendientesHome(){
    const tbody = document.getElementById('pendientesHomeBody');
    const empty = document.getElementById('pendientes-home-empty');
    if (!tbody || !window.CARITAS?.supabase) {
      empty?.removeAttribute("hidden");
      return;
    }
    tbody.innerHTML = '';
    try {
      const { data, error } = await window.CARITAS.supabase
        .from('pendientes')
        .select('descripcion, estado')
        .order('id', { ascending: true });
      if (error) throw error;

      if (!data || data.length === 0) {
        empty?.removeAttribute("hidden");
        return;
      }
      empty?.setAttribute("hidden","true");

      data.forEach(p => {
        const tr = document.createElement('tr');
        const safeText = (p.descripcion || '').replace(/[&<>"']/g,
          m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
        );
        tr.innerHTML = `
          <td>${safeText} ❤️</td>
          <td>${p.estado ? '✔️ Hecho' : '⏳ Pendiente'}</td>`;
        tbody.appendChild(tr);
      });
    } catch(err) {
      console.error('❌ Error cargando pendientes:', err);
      empty?.removeAttribute("hidden");
      empty.textContent = "Error al cargar pendientes.";
    }
  }

  renderPendientesHome();
  document.dispatchEvent(new CustomEvent('caritas:inicio:ready'));
})();
</script>