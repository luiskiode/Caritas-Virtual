<section class="inicio-card" id="tab-inicio">
  <!-- 📝 Mensaje semanal -->
  <div class="card" id="mensaje-semanal" style="margin-top:1rem">
    <h3 class="with-emoji" data-emoji="📝">Mensaje Semanal</h3>
    <p style="line-height:1.6">
      ✨ <strong>Queridos jóvenes</strong>, ustedes son la esperanza viva de una Iglesia en camino. Por eso les agradezco su presencia y su contribución a la vida del Cuerpo de Cristo. Y les pido: <em>no permitan que nos falte nunca el lío bueno que ustedes hacen</em>; el empuje que tienen, como el de un motor limpio y ágil; su modo original de vivir y anunciar la alegría de Jesús Resucitado. 🙏 Rezo por ello; y ustedes también, por favor, recen por mí. ❤️‍🔥
    </p>
  </div>

  <!-- 📌 Pendientes (solo lectura) -->
  <div class="card" style="margin:.8rem 0 1.2rem">
    <div style="display:flex;align-items:center;gap:.5rem;justify-content:space-between">
      <h3>📌 Mis pendientes</h3>
      <small class="pill">vista solo lectura</small>
    </div>
    <div id="pendientes-home-empty" class="muted" style="display:none;margin:.5rem 0">Sin pendientes aún. ✨</div>
    <table aria-label="Tabla de pendientes" style="margin-top:.5rem">
      <thead><tr><th>Tarea</th><th style="width:120px">Estado</th></tr></thead>
      <tbody id="pendientesHomeBody"></tbody>
    </table>
  </div>

  <!-- 🌟 Misión / 🚀 Visión -->
  <div class="card">
    <div class="mision-vision">
      <div class="mision">
        <h3>🌟 Nuestra Misión</h3>
        <ul>
          <li>❤️ Servir con respeto y empatía a las familias más necesitadas.</li>
          <li>🙏 Guiarnos por la fe, el compromiso y la compasión.</li>
          <li>🤝 Promover dignidad, justicia y solidaridad.</li>
          <li>🌱 Trabajar unidos para crear oportunidades y esperanza.</li>
          <li>🔥 Transformar vidas a través de la acción social.</li>
        </ul>
      </div>
      <div class="vision">
        <h3>🚀 Nuestra Visión</h3>
        <ul>
          <li>🏛 Ser referente de servicio y apoyo.</li>
          <li>💡 Construir una comunidad fraterna.</li>
          <li>✝ Inspirarnos en el Evangelio.</li>
          <li>🌍 Promover justicia social y desarrollo integral.</li>
          <li>🤗 Acompañar con acogida y transformación.</li>
        </ul>
      </div>
      <p class="agradecimiento">🙏 ¡Gracias por ser parte de esta misión! ❤️</p>
    </div>
  </div>

  <!-- 📷 Galería -->
  <div class="card" style="margin-top:1rem">
    <h3>📷 Nuestra comunidad</h3>
    <div class="galeria-grid">
      <img src="img/imagen de grupo 1.jpeg" alt="Imagen 1" class="miniatura" />
      <img src="img/imagen de grupo 2.jpeg" alt="Imagen 2" class="miniatura" />
      <img src="img/imagen de grupo 3.jpeg" alt="Imagen 3" class="miniatura" />
      <img src="img/imagen de grupo 4.jpeg" alt="Imagen 4" class="miniatura" />
      <img src="img/imagen de grupo 5.jpeg" alt="Imagen 5" class="miniatura" />
    </div>
  </div>

  <!-- 🖼️ Modal galería -->
  <div id="modal" class="modal" aria-hidden="true" role="dialog" aria-label="Imagen ampliada">
    <span class="cerrar" id="modalClose" aria-label="Cerrar">✖️</span>
    <img class="modal-contenido" id="img-ampliada" alt="Vista ampliada" />
    <div id="caption" style="color:#fff; margin-top:.4rem"></div>
  </div>
</section>

<script>
/* 🔧 Comportamiento de la pestaña Inicio (Cáritas) */
(function(){
  'use strict';

  // Galería con modal
  const modal = document.getElementById('modal');
  if (modal){
    const modalImg = document.getElementById('img-ampliada');
    const modalClose = document.getElementById('modalClose');
    const caption = document.getElementById('caption');
    document.querySelectorAll('.galeria-grid img').forEach(img=>{
      img.addEventListener('click', ()=>{
        modal.style.display='flex';
        modal.setAttribute('aria-hidden','false');
        modalImg.src = img.src;
        caption.textContent = img.alt || '';
      });
    });
    modalClose.addEventListener('click', ()=>{ modal.style.display='none'; modal.setAttribute('aria-hidden','true'); });
    modal.addEventListener('click', (e)=>{ if(e.target===modal) modalClose.click(); });
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') modalClose.click(); });
  }

  // Pendientes (solo lectura) — usa Supabase de CÁRITAS en la shell
  async function renderPendientesHome(){
    const tbody = document.getElementById('pendientesHomeBody');
    const empty = document.getElementById('pendientes-home-empty');
    if (!tbody) return;
    tbody.innerHTML = '';
    if (!window.CARITAS?.supabase){ if (empty) empty.style.display='block'; return; }
    try {
      const { data, error } = await window.CARITAS.supabase
        .from('pendientes')
        .select('descripcion, estado')
        .order('id', { ascending: true });
      if (error) throw error;
      if (!data || data.length===0){ if(empty) empty.style.display='block'; return; }
      if (empty) empty.style.display='none';
      data.forEach(p => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${(p.descripcion||'').replace(/</g,'&lt;')} ❤️</td><td>${p.estado ? '✔️ Hecho' : '⏳ Pendiente'}</td>`;
        tbody.appendChild(tr);
      });
    } catch(err){ console.error('Pendientes(home) error:', err); if(empty) empty.style.display='block'; }
  }
  renderPendientesHome();

  document.dispatchEvent(new CustomEvent('caritas:inicio:ready'));
})();
</script>