<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üéüÔ∏è Credencial ‚Äî C√°ritas CNC</title>
  <link rel="stylesheet" href="estilos-familias.css">

  <!-- Fuente Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script src="api.js/supabase-config-caritas.js"></script>

  <style>
    body { font-family: 'Poppins', sans-serif; background:#111; color:#f0f0f0; }
    .credencial-card {
      max-width: 650px; margin: 3rem auto; padding: 20px;
      border-radius: 16px; background: rgba(30,30,30,0.9);
      box-shadow: 0 6px 18px rgba(0,0,0,.5); display: flex; gap: 1.5rem;
      align-items: center; justify-content: space-between;
    }
    .foto {
      flex: 0 0 auto; text-align: center;
    }
    .foto img {
      width: 120px; height: 120px; border-radius: 12px;
      border: 3px solid #b91c1c; object-fit: cover;
    }
    .info {
      flex: 1; min-width: 250px;
    }
    .info h2 { margin: 0; font-weight: 600; }
    .info p { margin: 0.2rem 0; }
    .badge {
      display:inline-block; background:#b91c1c; color:#fff;
      padding:4px 10px; border-radius:20px; font-size:0.9rem;
      margin: 0.5rem 0;
    }
    .codigo {
      font-weight:600; color:#4da3ff; margin: 0.5rem 0;
    }
    footer {
      margin-top: 1rem; font-size: 0.85rem; color: #aaa; text-align: center;
    }
  </style>
</head>
<body>
  <div class="credencial-card">
    <div class="foto">
      <img id="fotoPerfil" src="img/avatar-placeholder.png" alt="Foto de perfil">
    </div>
    <div class="info">
      <h2 id="nombrePerfil">‚Äî</h2>
      <p id="emailPerfil">‚Äî</p>
      <span id="rolPerfil" class="badge">‚Äî</span>
      <p class="codigo">C√≥digo: <span id="codigoPerfil">‚Äî</span></p>
    </div>
  </div>
  <footer>üìå C√°ritas CNC</footer>

<script>
document.addEventListener("DOMContentLoaded", async ()=>{
  const supabase = window.CARITAS?.supabase;

  // Obtener el user_id desde la URL (?id=xxxx)
  const params = new URLSearchParams(window.location.search);
  const uid = params.get("id");

  if(!uid){
    alert("‚ùå Credencial no encontrada.");
    return;
  }

  try {
    const { data, error } = await supabase
      .from("credenciales")
      .select("*")
      .eq("user_id", uid)
      .single();

    if(error || !data){
      alert("‚ùå Credencial no v√°lida.");
      return;
    }

    // Llenar datos
    document.getElementById("nombrePerfil").textContent = data.nombre || "Usuario";
    document.getElementById("emailPerfil").textContent = data.email || "";
    document.getElementById("rolPerfil").textContent = data.rol || "Voluntario C√°ritas CNC";
    document.getElementById("codigoPerfil").textContent = data.codigo_verificacion || uid.substring(0,8).toUpperCase();
    document.getElementById("fotoPerfil").src = data.foto_url || 
      `https://ui-avatars.com/api/?name=${encodeURIComponent(data.nombre || "U")}&background=111&color=fff`;
  } catch(err){
    console.error("‚ùå Error cargando credencial:", err);
    alert("No se pudo cargar la credencial.");
  }
});
</script>
</body>
</html>