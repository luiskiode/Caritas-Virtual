<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#b71c1c" />
  <title>C√°ritas CNC</title>

  <link rel="icon" href="img/favicon.ico" />
  <link rel="stylesheet" href="styles-caritas.css" />

  <!-- ‚úÖ Pol√≠tica CSP corregida -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self';
             script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com https://esm.sh https://www.gstatic.com;
             style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://unpkg.com;
             img-src * data: blob:;
             connect-src *;
             font-src * data:;">

  <!-- FullCalendar -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js" defer></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

  <!-- Utilidades -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>

  <!-- Firebase (C√°ritas) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script defer src="api.js/firebase-config-caritas.js"></script>

  <!-- ‚úÖ Supabase (ESM, sin eval) -->
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

    const SUPABASE_URL = "https://qivjlsvcjyqymommfdke.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFpdmpsc3ZjanlxeW1vbW1mZGtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNjA2MjUsImV4cCI6MjA2OTkzNjYyNX0.YN0W5miJeWwu96jhqKiGB-cA8t9TeIboQWURCjTFVbw";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    window.CARITAS = window.CARITAS || {};
    window.CARITAS.supabase = supabase;

    console.log("‚úÖ Supabase inicializado sin eval (C√°ritas).");
  </script>

  <!-- Router SPA -->
  <script defer src="api.js/app-router-caritas.js"></script>

  <style>
    /* S√≥lo trazos m√≠nimos; el tema viene de styles-caritas.css */
    #status-bar{position:fixed;left:0;right:0;top:0;z-index:50;text-align:center;font-size:.9rem;padding:.35rem .6rem;display:none}
    #status-bar.offline{display:block;background:#111;color:#fff}
    .header-right{display:flex;gap:.4rem;align-items:center}
    .user-pill{display:none;align-items:center;gap:.4rem;background:#111;color:#fff;border-radius:999px;padding:.25rem .55rem}
    .user-pill img{width:22px;height:22px;border-radius:50%;object-fit:cover;border:2px solid #b71c1c}
    .brand-pin, .brand-home{cursor:pointer}
    .skeleton{animation:pulse 1.2s ease-in-out infinite;background:linear-gradient(90deg,#0000,#0002 40%,#0000 60%),var(--surface,#111);min-height:180px;border-radius:12px}
    @keyframes pulse{0%{background-position:-200% 0}100%{background-position:200% 0}}
    @media (prefers-reduced-motion: reduce){
      #video-fondo{display:none !important}
    }
  </style>
</head>
<body>
  <!-- Conectividad -->
  <div id="status-bar" aria-live="polite"></div>

  <!-- üé• Video de fondo -->
  <video id="video-fondo" autoplay muted loop>
    <source src="videos/fondo.mp4" type="video/mp4">
  </video>

  <!-- üîù Header -->
  <header class="app-header">
    <h1>
      <span id="pinLogin" class="brand-pin" title="Iniciar sesi√≥n">üìå</span>
      <span id="brandHome" class="brand-home" title="Ir a Inicio">C√°ritas CNC</span>
    </h1>

    <nav id="main-nav" aria-label="Navegaci√≥n principal">
      <button data-view="inicio" aria-current="page">üè† Inicio</button>
      <button data-view="registro-fam" data-newtab>üë®‚Äçüë©‚Äçüëß Registro</button>
      <button data-view="perfil" id="btnPerfil" style="display:none" data-newtab>üë§ Perfil</button>
      <button data-view="servicios" id="btnServicios" style="display:none" data-newtab>‚öôÔ∏è Servicios</button>
      <button id="btnLogout" style="display:none">üîí Salir</button>
    </nav>

    <div class="header-right">
      <div id="userPill" class="user-pill" title="Sesi√≥n activa">
        <img id="userAvatar" src="img/avatar-placeholder.png" alt="Avatar" />
        <span id="userName">‚Äî</span>
        <small id="userRole" class="pill" style="margin-left:.25rem">voluntario</small>
      </div>
    </div>
  </header>

  <!-- üîî Bienvenida din√°mica -->
  <section id="bienvenida" class="card center" style="margin:1rem auto;max-width:800px;display:none">
    <h2 id="bienvenida-text">üëã Bienvenid@ a tu plataforma de servicio</h2>
  </section>

  <!-- üìå Contenedor din√°mico -->
  <main id="app" class="seccion active" aria-live="polite">
    <div class="card skeleton" style="margin:1rem auto;max-width:960px;"></div>
  </main>

  <noscript>
    <div class="card" style="max-width:960px;margin:1rem auto">
      <h2>‚ö†Ô∏è JavaScript deshabilitado</h2>
      <p>Activa JavaScript para usar la aplicaci√≥n.</p>
    </div>
  </noscript>

  <!-- === Scripts de UI y l√≥gica (sin cambios) === -->
  <script>
  (() => {
    'use strict';
    /* ‚Ä¶ aqu√≠ mantuve todo tu bloque JS exactamente igual ‚Ä¶ */
  })();
  </script>
</body>
</html>