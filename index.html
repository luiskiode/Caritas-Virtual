<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ================== META ================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Cáritas CNC</title>

  <!-- ================== ESTILOS ================== -->
  <link rel="stylesheet" href="styles.css" />

  <!-- ================== ICONOS ================== -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- ================== MAPAS (Leaflet) ================== -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

  <!-- ================== QR Code ================== -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <!-- ================== SUPABASE ================== -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <script>
    // Cliente global Supabase
    window.supabaseClient = supabase.createClient(
      "https://qivjlsvcjyqymommfdke.supabase.co",
      "TU_ANON_KEY_AQUI"
    );
  </script>
</head>

<body>
  <!-- ================== HEADER / NAVEGACIÓN ================== -->
  <header class="app-header">
    <h1><i class="fas fa-church"></i> Cáritas CNC</h1>
    <nav>
      <button type="button" onclick="showSection('inicio')" class="tabbtn">Inicio</button>
      <button type="button" onclick="showSection('credenciales')" class="tabbtn">Credenciales</button>
      <button type="button" onclick="showSection('registro')" class="tabbtn">Registro</button>
      <button type="button" onclick="showSection('login')" id="btn-login">Iniciar sesión</button>
      <button type="button" id="btn-logout" style="display:none" onclick="logout()">Cerrar sesión</button>
    </nav>
  </header>

  <!-- ================== MAIN ================== -->
  <main>

    <!-- ====== SECCIÓN: INICIO ====== -->
    <section id="inicio" class="seccion active">
      <div class="inicio-card">
        <h2>Bienvenido a Cáritas CNC ❤️</h2>
        <p>Plataforma de gestión para el voluntariado de Cáritas CNC.</p>
      </div>
    </section>

    <!-- ====== SECCIÓN: CREDENCIALES ====== -->
    <section id="credenciales" class="seccion">
      <h2>Credenciales</h2>
      <div class="card">
        <h3>Crear Credencial</h3>
        <input type="email" id="cred-email" placeholder="Correo electrónico" />
        <input type="password" id="cred-password" placeholder="Contraseña" />
        <input type="file" id="foto-perfil" accept="image/*" />
        <button id="btn-crear-credencial" class="btn-big">Crear credencial</button>
        <canvas id="qr-canvas"></canvas>
        <button id="btn-ver-credencial" style="display:none;">
          <i class="fa-solid fa-id-card"></i> Ver Credencial
        </button>
      </div>
    </section>

    <!-- ====== SECCIÓN: REGISTRO DE FAMILIAS ====== -->
    <section id="registro" class="seccion">
      <h2>Registro de Familias</h2>
      <div id="msg"></div>
      <form id="familiaForm" enctype="multipart/form-data" class="card">
        <label>Nombres y Apellidos*</label>
        <input type="text" name="nombres_apellidos" required />
        <label>DNI*</label>
        <input type="text" name="dni_solicitante" maxlength="8" pattern="[0-9]{8}" required />
        <label>Apellido Familia*</label>
        <input type="text" name="apellido_familia" required />
        <label>Dirección*</label>
        <input type="text" name="direccion" required />
        <label>Fecha de Registro*</label>
        <input type="date" name="fecha_registro" required />
        <label>Teléfono*</label>
        <input type="text" name="telefono_contacto" pattern="[0-9]+" required />
        <label>Observaciones</label>
        <textarea name="observaciones"></textarea>
        <button type="submit" class="submit-btn">Registrar</button>
      </form>
    </section>

    <!-- ====== SECCIÓN: LOGIN ====== -->
    <section id="login" class="seccion">
      <h2>Iniciar Sesión</h2>
      <form id="loginForm" class="card">
        <input type="email" id="email" placeholder="Correo electrónico" required />
        <input type="password" id="password" placeholder="Contraseña" required />
        <button type="submit" class="submit-btn">Entrar</button>
      </form>
      <div id="loginMessage"></div>
      <div style="text-align:center; margin-top:.5rem;">
        <a href="#" onclick="resetPass();return false;">¿Olvidaste tu contraseña?</a>
      </div>
    </section>
  </main>

  <!-- ================== FOOTER ================== -->
  <footer>© 2025 Cáritas CNC. Todos los derechos reservados.</footer>

  <!-- ================== SCRIPTS ================== -->
  <script src="credenciales.js" type="module"></script>
  <script src="familias.js" type="module"></script>
  <script src="login-supabase.js" type="module"></script>
  <script>
    // Navegación entre secciones
    function showSection(id) {
      document.querySelectorAll('.seccion').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id)?.classList.add('active');
    }

    // Cerrar sesión
    async function logout() {
      await supabaseClient.auth.signOut();
      document.getElementById("btn-login").style.display = "inline-block";
      document.getElementById("btn-logout").style.display = "none";
      showSection("inicio");
    }
  </script>
</body>
</html>
