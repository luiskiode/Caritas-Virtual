<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cáritas CNC</title>
  <link rel="stylesheet" href="styles.css?v=3" />

  <!-- ====== Librerías externas ====== -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

  <!-- Librería QR -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

  <!-- Manifest y Service Worker -->
  <link rel="manifest" href="manifest.json" />
</head>
<body>
  <!-- ================== Header ================== -->
  <header class="app-header">
    <h1>Cáritas CNC</h1>
    <nav>
      <button onclick="mostrarSeccion('inicio')">Inicio</button>
      <button onclick="mostrarSeccion('familias')">Familias</button>
      <button onclick="mostrarSeccion('credenciales')">Credenciales</button>
      <button onclick="mostrarSeccion('calendario')">Calendario</button>
      <button onclick="mostrarSeccion('mapa')">Mapa</button>
    </nav>
  </header>

  <!-- ================== Inicio ================== -->
  <section id="inicio" class="seccion active">
    <div class="inicio-card">
      <h2>Bienvenido</h2>
      <p>Plataforma Cáritas CNC - Gestión de Familias y Credenciales.</p>
    </div>
  </section>

  <!-- ================== Familias ================== -->
  <section id="familias" class="seccion">
    <h2>Registro de Familias</h2>
    <form id="familiaForm" class="card">
      <label>Nombre de familia</label>
      <input type="text" name="nombre" required />

      <label>Dirección</label>
      <input type="text" name="direccion" required />

      <label>Teléfono</label>
      <input type="tel" name="telefono" />

      <button type="submit" class="submit-btn">Guardar</button>
    </form>

    <div id="familiasList" class="card" style="margin-top:1rem;">
      <h3>Listado de Familias</h3>
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Dirección</th>
            <th>Teléfono</th>
          </tr>
        </thead>
        <tbody id="familiasTable"></tbody>
      </table>
    </div>
  </section>

  <!-- ================== Credenciales ================== -->
  <section id="credenciales" class="seccion">
    <h2>Crear Credencial</h2>
    <form id="credencialForm" class="card">
      <input type="email" id="email" placeholder="Correo" required />
      <input type="password" id="password" placeholder="Contraseña" required />
      <input type="file" id="foto-perfil" accept="image/*" required />
      <button type="button" id="crear-credenciales" class="submit-btn">Crear</button>
    </form>

    <canvas id="qr-canvas" style="margin-top:1rem;"></canvas>
    <button id="ver-credencial" style="display:none;" class="btn-big">Ver Credencial</button>
  </section>

  <!-- ================== Calendario ================== -->
  <section id="calendario" class="seccion">
    <h2>Calendario</h2>
    <div id="calendar"></div>
  </section>

  <!-- ================== Mapa ================== -->
  <section id="mapa" class="seccion">
    <h2>Mapa</h2>
    <div id="map"></div>
  </section>

  <!-- ================== Footer ================== -->
  <footer>
    Cáritas CNC © 2025
  </footer>

  <!-- ================== Scripts ================== -->
  <script>
    // Control de secciones
    function mostrarSeccion(id) {
      document.querySelectorAll(".seccion").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // Service Worker
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("service-worker.js").then(() => {
        console.log("✅ Service Worker registrado");
      }).catch(err => console.error("❌ Error SW:", err));
    }
  </script>

  <!-- ================== Módulos de la app ================== -->
  <script type="module" src="supabase-config.js"></script>
  <script type="module" src="credenciales.js"></script>
  <script type="module" src="familias.js"></script>
  <script type="module" src="login-supabase.js"></script>
</body>
</html>
